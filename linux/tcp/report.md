<h1 align="center"> Linux作业3-Shell脚本 </h1>

| 姓名：马嘉骥 | 班级：2018211303 | 学号：2018211149 | 班内序号：15 |
| ------------ | ---------------- | ---------------- | ------------ |

## 生成TCP活动状况报告

### 运行结果

```
[root@server Linux_TCP]# ./tcp.sh > tcp_out.txt
[root@server Linux_TCP]# cat tcp_out.txt
 2021-05-24 14:37 1148 1148 2296    
 2021-05-24 14:38  917  917 1834    -
 2021-05-24 14:39  929  929 1858    +
 2021-05-24 14:40  966  966 1932    +
 2021-05-24 14:41  721  721 1442    -
 2021-05-24 14:42 1012 1012 2024    +
 2021-05-24 14:43 1135 1135 2270    +
 2021-05-24 14:44 1337 1337 2674    +
 2021-05-24 14:45 1189 1189 2378    -
 2021-05-24 14:46 1076 1076 2152    -
 2021-05-24 14:47  982  982 1964    -
 2021-05-24 14:48  904  904 1808    -
 2021-05-24 14:49  935  935 1870    +
 2021-05-24 14:50 1514 1514 3028    +
 2021-05-24 14:51  814  814 1628    -
 2021-05-24 14:52 1268 1268 2536    +
 2021-05-24 14:53 1305 1305 2610    +
 2021-05-24 14:54 1022 1022 2044    -
 2021-05-24 14:55  832  832 1664    -
 2021-05-24 14:56 1125 1125 2250    +
 2021-05-24 14:57  877  877 1754    -
 下略
```

### 源码

```bash
comp()
{
	if [ $2 -gt $(expr $1 + 10) ]
	then
		eval "$3=\"+\""	
	elif [ $2 -gt $(expr $1 - 10) ]
	then
		eval "$3=\" \""
	else
		eval "$3=\"-\""
	fi
}

output()
{
	outnum=`expr $2 - $4`
	recvnum=`expr $1 - $3`
	sum=`expr $outnum + $recvnum`
	if [ $7 -gt 0 ]
	then
		comp $pre_sum $sum "flag"
    fi
	pre_sum=$sum
	eval "$5=$1";eval "$6=$2"
	echo -e "\r" `date "+%Y-%m-%d %H:%M"` "\c"
	printf "%4d %4d %4d %4c\n" $outnum $recvnum $sum $flag
}

index=0
while (true)
	do
	sleep 60
	str=`netstat --statistics | grep "[0-9][0-9]* segments received"`
	tcp_recv=$(expr "$str" : '^ *\([0-9][0-9]*\).*$')
	tcp_out=$(expr "$str" : '^ *\([0-9][0-9]*\).*$')
	output $tcp_recv $tcp_out $recv $out "recv" "out" $index
	index=$(expr $index + 1)
done
```

